# Readme

**Paper 'Multi-Modal Sketch-based Behavior Tree Synthesis' artifact evaluation**

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.16921187.svg)](https://doi.org/10.5281/zenodo.16921187)

This artifact evaluation is consistent with the order of the paper and is **presented following the order of RQ1 to RQ4 in paper**.

## Getting Started

Our work has been deployed in a **Docker container** and packaged as an **image** for release. You can retrieve the **Docker image** using the following command:

```
docker pull btbot123/btbot:latest
```

To reproduce this work, you need to have an **OpenAI API key** to prompt LLM (GPT). Below, we will provide ***Kick-the-Tires*** to briefly show how BtBot solves tasks and generates BTs, and provide ***Step-by-Step Instructions*** to provide a detailed introduction to the experimental replication process in the paper.

Since the timeout of the task in the paper is 3600 seconds, the reproduction of the experiment will take a long time. In order to shorten the time required for reproduction, we provide a version with a task timeout of 360 seconds (which still takes time). In the docker, the **/BTBOT** stores files with a task timeout of 3600 seconds. The **/BTBOT_short** stores files with a task timeout of 360 seconds.

**Note:** Since the output of LLMs is **not deterministic**, there may be **slight deviations** between the results and the data in the paper, which is **normal**. During execution, *error messages* may be produced when the LLM outputs gibberish or when its output cannot be correctly parsed into a sketch. This is not problematic, as the program will not terminate; instead, it will **re-invoke** the LLM until the maximum retry limit is reached.

Firstly select one of the directories. For example:

```
cd BTBOT_short
```



## Kick-the-Tires



- In order to quickly verify the usability of the artifact, you can try to execute the following command in **/BTBOT_short** to view the BT program generated by BtBot.
  - Please replace \*\*\* in the parameter --url with the **URL** of LLM.
  - Please replace \*\*\* in the parameter --key with the **API key** of LLM.
  - Please replace \*\*\* in the parameter --llm with the **LLM** to prompt, such as **gpt-4o**.
  - The parameter in the --data-path specifies the dependent file path of the executable file. No modification is required. You can also specify the dependent file directory as **/BTBOT_short/data**.

```
./dist/RQ2_1 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT_short/data"
```

- **Output:** In the terminal, you can see the **task names** and the **BT programs** generated by BtBot, as well as the comparison results between BtBot and BTGenBot in RQ2 (Table 2). For example, *MCTS_task1* task is *to move to positions 1, 2, 4, and 5 in sequence*. Generate a BT program as shown in the figure.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/KICK.png)







## Step-by-Step Instructions


### Benchmark

- Execute the following command to get the distribution of the benchmark, including the complexity distribution of the task (the number of nodes included in target BT) and the distribution of positive and negative examples of the specification.

```
python3 box2.py
```

- **Output:** Generate two files, the **benchmark.pdf** corresponds to the distribution in **Fig.11**. The **example_distribution.png** corresponds to the distribution in **Fig.12**.






### RQ1

- RQ1 discusses the impact of different LLMs (*GPT-3.5, GPT-4, GPT-4o*) on the performance of BtBot and BTLLMGen. Execute the following command to get the results consistent with **Table 1** in the paper.
  - Please replace \*\*\* in the parameter --url with the **URL** of LLM.
  - Please replace \*\*\* in the parameter --key with the **API key** of LLM.
  - Please replace \*\*\* in the parameter --llm with the **LLM** to prompt, such as **gpt-4o** (This parameter is not used but is needed in RQ1).
  - The parameter in --data-path specifies the dependent file path of the executable file. No modification is required. You can also specify the dependent file directory as **/BTBOT_short/data**.

```
./dist/RQ1 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT/data"
```

- **Output:** Executing this command will output the same results as **Table 1** in the terminal, which are the results of using BtBot and BTLLMGen on three different LLMs. As shown in the figure below.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ1.png)




### RQ2

- RQ2 discusses the comparison between the performance of BtBot and existing works.



#### RQ2_1

- RQ2_1 discusses the comparison between **BtBot** and **BTGenBot** on the BTGenBot's test set tasks. Execute the following command to get the results consistent with **Table 2** in the paper.
  - The parameters in this command are the same as those in RQ1.
  -  The paper employs GPT-4o as the sketch generator for BtBot, so the "--llm" parameter here should be set to "gpt-4o".

```
./dist/RQ2_1 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT/data"
```

- **Output:** Executing this command will output the same results as **Table 2** in the terminal. As shown in the figure below.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ2_1.png)




#### RQ2_2

- This experiment discusses the comparison of the performance of **BtBot** with **MCTS_Syn** and **BTLLMGen-GPT4o** on the benchmark. 
- In addition, in the modified version of the paper, we will **add the baseline BTLLMExam-GPT4o**. The difference between this baseline and BTLLMGen-GPT4o is that the positive and negative example information of the task and the wrong BT generated by LLMs with its unsatisfied examples are also provided to LLMs, requiring LLMs to generate or regenerate a BT.
- Execute the following command to get the results consistent with **Fig. 14** of the paper.
  - The parameters --url, --key and --llm in this command are the same as those of RQ1. The difference is that the path of the dependent files is specified by **data_path** (required by the script).
  - The paper employs GPT-4o as the sketch generator for BtBot, so the "--llm" parameter here should be set to "**gpt-4o**".

```
./dist/RQ2_2 --result "result" --url "***" --key "***" --llm "***" --data_path "/BTBOT/data"
```

- **Output:** Executing this command will output the result consistent with **Fig.14** in the paper in the terminal, as shown in the figure below. And **RQ2_2.png** is generated that can intuitively display the results.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ2_2.png)










### RQ3

- This experiment discusses the **ablation** experiment of BtBot. Execute the following command to get the results consistent with **Fig.15** in the paper.
  - The parameters in this command are consistent with those in RQ1.
  - The paper employs GPT-4o as the sketch generator for BtBot, so the "--llm" parameter here should be set to "**gpt-4o**".

```
./dist/RQ3 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT/data"
```

- **Output:** Executing this command will output the result consistent with **Fig.15** in the paper in the terminal, as shown in the figure below. And **RQ3.png** is generated that can intuitively display the result.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ3.png)








### RQ4

- About User Study.
- The data of the two user studies are provided in **/BTBOT/data** in the docker.
- The **userStudy.zip** stores the data of the user study in the paper, where *T or 1* indicates task success and *F or 0* indicates task failure.
- The **US_repeat.zip** stores the data supplemented in the review stage *(In the supplementary experiment, participants were provided with counterexamples for failed tasks and were allowed to attempt the task multiple times)*. 0 indicates task failure and 1 indicates successful task resolution.
-  There are many reasons for task failure by Manual, including behavior tree grammar errors, illegal characters, semantics not consisted with task specifications, etc. As a result, some tasks do not have specific error analysis.
  - The user study in the paper consistent with **Fig.16** is shown in the first figure below. 
  - The last two figures are the results by Manual and BtBot supplemented in the review stage (Participants can make repeated modifications).
    
![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/US1.png)
![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/US2.png)
![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/US3.png)






