# Readme

**OOPSLA24-25-[#1365 Multi-Modal Sketch-based Behavior Tree Synthesis](https://oopsla2425.hotcrp.com/paper/1365) artifact evaluation**

This artifact evaluation is consistent with the order of the paper and is introduced in the order of **RQ 1 to 4**.

Our work has been deployed in the docker. Please **pull down the docker** using the following command.

```
docker pull btbot123/btbot
```

To reproduce this work, you need to have the **OpenAI API key** to prompt LLM (GPT). Below we will explain the steps to reproduce the experiment in detail.

Since the timeout of the task in the paper is 3600 seconds, the reproduction experiment will take a long time. In order to shorten the time required for reproduction, we provide a version with a task timeout of 360 seconds. In the docker, the **/BTBOT** directory stores files with a task timeout of 3600 seconds. The **/BTBOT_short** directory stores files with a task timeout of 360 seconds.

Since the output of LLMs is not **deterministic**, there may be **slight deviations** in the results, which is **normal**.

First select one of the directories. For example:

```
cd BTBOT_short
```



## Kick-the-Tires

<hr style="height:4px;border-width:0;color:gray;background-color:gray">

- In order to quickly verify the usability of the artifact, you can try to execute the following command in **/BTBOT_short** to view the BT program generated by BtBot.
  - Please replace \*\*\* in the parameter --url with the **OpenAI URL** of LLM.
  - Please replace \*\*\* in the parameter --key with the **OpenAI API key** of LLM.
  - Please replace \*\*\* in the parameter --llm with the **LLM** to prompt, such as **gpt-4o**.
  - The parameter in --data-path specifies the dependent file path of the executable file. No modification is required. You can also specify the dependent file directory as **/BTBOT_short/data**

```
./dist/RQ2_1 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT_short/data"
```

- In the terminal, you can see the **task name** and the **behavior tree program** generated by BtBot. For example *MCTS_task1* task is *to move to positions 1, 2, 4, and 5*.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/KICK.png)

<hr style="height:4px;border-width:0;color:gray;background-color:gray">





## Full Instructions

<hr style="height:4px;border-width:0;color:gray;background-color:gray">

### Benchmark

- Execute the following command to get the distribution of the benchmark, including the complexity distribution of the task (the number of nodes included in target BT) and the distribution of positive and negative examples of the specification.

```
python3 box2.py
```

- Generate two files, the **benchmark.pdf**  corresponds to the distribution in **Fig.11.**. The **example_distribution.png** corresponds to the distribution in **Fig.12.**.

<hr style="height:4px;border-width:0;color:gray;background-color:gray">





### RQ1

- RQ1 discusses the impact of different LLMs (*GPT-3.5, GPT-4, GPT-4o*) on the performance of BtBot and BTLLMGen. Execute the following command to get the results consistent with **Table 1.** in the paper.
  - Please replace \*\*\* in the parameter --url with the **OpenAI URL** of LLM.
  - Please replace \*\*\* in the parameter --key with the **OpenAI API key** of LLM.
  - Please replace \*\*\* in the parameter --llm with the **LLM** to prompt, such as **gpt-4o** (This parameter is not used but is needed in RQ1).
  - The parameter in --data-path specifies the dependent file path of the executable file. No modification is required. You can also specify the dependent file directory as **/BTBOT_short/data**

```
./dist/RQ1 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT/data"
```

- **Output results: **Executing this command will output the same results as **Table 1.** in the terminal, which are the results of using BtBot and BTLLMGen on three different LLMs. As shown in the figure below.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ1.png)


<hr style="height:4px;border-width:0;color:gray;background-color:gray">




### RQ2

- RQ2 discusses the comparison between the effects of BtBot and existing works.



#### RQ2_1

- RQ2_1 discusses the comparison between **BtBot** and **BTGenBot** on the BTGenBot's test set tasks. Execute the following command to get the results consistent with **Table 2.** in the paper.
  - The parameters in this command are the same as those in RQ1.
  -  The result in the paper is the result of calling **GPT-4o** to solve the task.

```
./dist/RQ2_1 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT/data"
```

- **Output:** Executing this command will output the same results as **Table 2.** in the terminal. As shown in the figure below.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ2_1.png)




#### RQ2_2

- This experiment discusses the comparison of the performance of **BtBot** with **MCTS_Syn** and **BTLLMGen-GPT4o** on the benchmark. Execute the following command to get the results consistent with **Fig. 14.** of the paper. 
- In addition, in the modified version of the paper, we will **add the baseline BTLLMExam-GPT4o**. The difference between this baseline and BTLLMGen-GPT4o is that the positive and negative example information of the task and the wrong BT generated by LLMs with its unsatisfied examples are also provided to LLMs, requiring LLMs to generate or regenerate a BT.
  - The parameters --url, --key and --llm in this command are the same as those of RQ1. The difference is that the path of the dependent files is specified by **data_path** (required by the script).
  - The result in the paper is the result of calling **GPT-4o** to solve the task.

```
./dist/RQ2_2 --result "result" --url "***" --key "***" --llm "***" --data_path "/BTBOT/data"
```

- **Output result: **Executing this command will output the result consistent with **Fig.14.** in the paper in the terminal, as shown in the figure below. And **RQ2_2.png** is  generated that can intuitively display the results.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ2_2.png)


<hr style="height:4px;border-width:0;color:gray;background-color:gray">







### RQ3

- This experiment discusses the **ablation** experiment results of BtBot. Execute the following command to get the results consistent with **Fig.15.** in the paper.
  - The parameters in this command are consistent with those in RQ1.
  - The result in the paper is the result of calling **GPT-4o** to solve the task.

```
./dist/RQ3 --result "result" --url "***" --key "***" --llm "***" --data-path "/BTBOT/data"
```

- **Output result: **Executing this command will output the result consistent with **Fig.15.** in the paper in the terminal. And **RQ3.png** is generated  that can intuitively display the result.

![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/RQ3.png)

<hr style="height:4px;border-width:0;color:gray;background-color:gray">






### User Study

- The data of the two user studies are provided in the directory **/BTBOT/data** in the docker. The **userStudy.zip** stores the data of the user study in the paper, where *T or 1* indicates task success and *F or 0* indicates task failure.
- The **US_repeat.zip** stores the data supplemented in the review stage. *(The supplementary experiment provides participants with counterexamples that are not satisfied when the task fails, and they can try to solve the task multiple times. 0 indicates task failure and 1 indicates successful task resolution.)*
-  There are many reasons for task failure by Manual, including behavior tree grammar error, illegal characters, semantics not consisted with task specifications, etc. As a result, some tasks do not have specific error analysis.
  - The user study in the paper is shown in the first figure below. 
  - The last two figures are the results by Manual and BtBot supplemented in the review stage (two methods).
![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/US1.png)
![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/US2.png)
![image-KICK](https://github.com/BTBOT-src/BTBOT/blob/main/US3.png)


<hr style="height:4px;border-width:0;color:gray;background-color:gray">



